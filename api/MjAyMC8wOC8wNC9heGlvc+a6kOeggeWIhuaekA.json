{"title":"æ·±å…¥ç†è§£ axios","date":"2020-08-04T09:02:16.000Z","date_formatted":{"ll":"Aug 4, 2020","L":"08/04/2020","MM-DD":"08-04"},"link":"2020/08/04/axiosæºç åˆ†æ","updated":"2020-08-10T13:04:41.414Z","content":"<h1 id=\"axios-æ˜¯ä»€ä¹ˆ\">axios æ˜¯ä»€ä¹ˆ<a title=\"#axios-æ˜¯ä»€ä¹ˆ\" href=\"#axios-æ˜¯ä»€ä¹ˆ\"></a></h1>\n<p><code>axios</code> æ˜¯åŸºäº <code>Promise</code> å¹¶ç”¨äºæµè§ˆå™¨å’Œ <code>node.js</code> çš„ <code>HTTP</code> è¯·æ±‚åº“ã€‚</p>\n<h1 id=\"axios-çš„å¸¸è§åŠŸèƒ½\">axios çš„å¸¸è§åŠŸèƒ½<a title=\"#axios-çš„å¸¸è§åŠŸèƒ½\" href=\"#axios-çš„å¸¸è§åŠŸèƒ½\"></a></h1>\n<ul>\n<li>æ”¯æŒè¯·æ±‚ã€å“åº”æ‹¦æˆª</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Add a request interceptor</span></span><br><span class=\"line\">axios.interceptors.request.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">config</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Do something before request is sent</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">  &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Do something with request error</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Add a response interceptor</span></span><br><span class=\"line\">axios.interceptors.response.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class=\"line\">    <span class=\"comment\">// Do something with response data</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">  &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class=\"line\">    <span class=\"comment\">// Do something with response error</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(error);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>å–æ¶ˆè¯·æ±‚</li>\n</ul>\n<ol>\n<li>é€šè¿‡ <code>CancelToken.source</code> è¿™ä¸ªå·¥å‚å‡½æ•°æ¥è·å– <code>cancel</code> å‡½æ•°ã€‚</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> CancelToken = axios.CancelToken;</span><br><span class=\"line\"><span class=\"keyword\">const</span> source = CancelToken.source();</span><br><span class=\"line\"></span><br><span class=\"line\">axios.get(<span class=\"string\">'/user/12345'</span>, &#123;</span><br><span class=\"line\">  cancelToken: source.token</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">thrown</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (axios.isCancel(thrown)) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request canceled'</span>, thrown.message);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// handle error</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">axios.post(<span class=\"string\">'/user/12345'</span>, &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'new name'</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  cancelToken: source.token</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// cancel the request (the message parameter is optional)</span></span><br><span class=\"line\">source.cancel(<span class=\"string\">'Operation canceled by the user.'</span>);</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>é€šè¿‡ <code>CancelToken</code> çš„æ„é€ å‡½æ•°æ¥è·å– <code>cancel</code> å‡½æ•°ã€‚</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> CancelToken = axios.CancelToken;</span><br><span class=\"line\"><span class=\"keyword\">let</span> cancel;</span><br><span class=\"line\"></span><br><span class=\"line\">axios.get(<span class=\"string\">'/user/12345'</span>, &#123;</span><br><span class=\"line\">  cancelToken: <span class=\"keyword\">new</span> CancelToken(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">executor</span>(<span class=\"params\">c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// An executor function receives a cancel function as a parameter</span></span><br><span class=\"line\">    cancel = c;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// cancel the request</span></span><br><span class=\"line\">cancel();</span><br></pre></td></tr></table></figure>\n<ul>\n<li>é¢„é˜² <code>XSRF</code></li>\n</ul>\n<p>å¯ä»¥é€šè¿‡è®¾ç½® <code>XSRF token</code> æ¥é¢„é˜² <code>XSRF/CSRF</code>ã€‚</p>\n<ul>\n<li>æ”¯æŒ <code>Promise API</code></li>\n<li>è·å–ä¸Šä¼ ã€ä¸‹è½½è¿›åº¦</li>\n</ul>\n<h1 id=\"axios-æºç åˆ†æ\">axios æºç åˆ†æ<a title=\"#axios-æºç åˆ†æ\" href=\"#axios-æºç åˆ†æ\"></a></h1>\n<h2 id=\"ç›®å½•\">ç›®å½•<a title=\"#ç›®å½•\" href=\"#ç›®å½•\"></a></h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”œâ”€â”€ adapters</span><br><span class=\"line\">â”‚   â”œâ”€â”€ README.md</span><br><span class=\"line\">â”‚   â”œâ”€â”€ http.js</span><br><span class=\"line\">â”‚   â””â”€â”€ xhr.js</span><br><span class=\"line\">â”œâ”€â”€ axios.js</span><br><span class=\"line\">â”œâ”€â”€ cancel</span><br><span class=\"line\">â”‚   â”œâ”€â”€ Cancel.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ CancelToken.js</span><br><span class=\"line\">â”‚   â””â”€â”€ isCancel.js</span><br><span class=\"line\">â”œâ”€â”€ core</span><br><span class=\"line\">â”‚   â”œâ”€â”€ Axios.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ InterceptorManager.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ README.md</span><br><span class=\"line\">â”‚   â”œâ”€â”€ buildFullPath.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ createError.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ dispatchRequest.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ enhanceError.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ mergeConfig.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ settle.js</span><br><span class=\"line\">â”‚   â””â”€â”€ transformData.js</span><br><span class=\"line\">â”œâ”€â”€ defaults.js</span><br><span class=\"line\">â”œâ”€â”€ helpers</span><br><span class=\"line\">â”‚   â”œâ”€â”€ README.md</span><br><span class=\"line\">â”‚   â”œâ”€â”€ bind.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ buildURL.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ combineURLs.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ cookies.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ deprecatedMethod.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ isAbsoluteURL.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ isURLSameOrigin.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ normalizeHeaderName.js</span><br><span class=\"line\">â”‚   â”œâ”€â”€ parseHeaders.js</span><br><span class=\"line\">â”‚   â””â”€â”€ spread.js</span><br><span class=\"line\">â””â”€â”€ utils.js</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ ¸å¿ƒåŠŸèƒ½\">æ ¸å¿ƒåŠŸèƒ½<a title=\"#æ ¸å¿ƒåŠŸèƒ½\" href=\"#æ ¸å¿ƒåŠŸèƒ½\"></a></h2>\n<h3 id=\"axios-æ„é€ å‡½æ•°\">Axios æ„é€ å‡½æ•°<a title=\"#axios-æ„é€ å‡½æ•°\" href=\"#axios-æ„é€ å‡½æ•°\"></a></h3>\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ„é€ å‡½æ•°èµ·åˆ°ä¸€ä¸ªåˆå§‹åŒ–å†…éƒ¨å¯¹è±¡çš„ä½œç”¨ï¼Œå½“ç„¶ <code>axios</code> ä¹Ÿä¸ä¾‹å¤–ğŸ‘‡</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Create a new instance of Axios</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>instanceConfig The default config for the instance</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Axios</span>(<span class=\"params\">instanceConfig</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.defaults = instanceConfig;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.interceptors = &#123;</span><br><span class=\"line\">    request: <span class=\"keyword\">new</span> InterceptorManager(),</span><br><span class=\"line\">    response: <span class=\"keyword\">new</span> InterceptorManager()</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"axios.prototype.request\">Axios.prototype.request<a title=\"#axios.prototype.request\" href=\"#axios.prototype.request\"></a></h3>\n<p>è¿™ä¸ªå‡½æ•°ä¸€å…±åšäº†è¿™äº›äº‹æƒ…ï¼š</p>\n<ol>\n<li>åˆå¹¶é…ç½®</li>\n<li>è®¾ç½®è¯·æ±‚æ–¹æ³•ï¼ˆä¹Ÿå¯ä»¥å½’åˆ°ä¸Šä¸€æ­¥ï¼‰</li>\n<li>ç»‘å®šæ‹¦æˆªå™¨å¹¶ç”Ÿæˆ <code>promise</code> é˜Ÿåˆ—</li>\n<li>æ‰§è¡Œ <code>promise</code> é˜Ÿåˆ—</li>\n<li>è¿”å›æ‰§è¡Œç»“æœ</li>\n</ol>\n<p>å¯ä»¥è¯´ï¼Œç†è§£äº†è¿™æ®µæè¿°ï¼Œå°±èƒ½ç†æ¸… <code>axios</code> å¤§è‡´çš„æµç¨‹äº†ã€‚ä¸‹é¢æ˜¯å…·ä½“çš„ä»£ç ğŸ‘‡</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Dispatch a request</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>config The config specific for this request (merged with this.defaults)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Axios.prototype.request = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">config</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/*eslint no-param-reassign:0*/</span></span><br><span class=\"line\">  <span class=\"comment\">// Allow for axios('example/url'[, config]) a la fetch API</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> config === <span class=\"string\">'string'</span>) &#123;</span><br><span class=\"line\">    config = <span class=\"built_in\">arguments</span>[<span class=\"number\">1</span>] || &#123;&#125;;</span><br><span class=\"line\">    config.url = <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    config = config || &#123;&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  config = mergeConfig(<span class=\"keyword\">this</span>.defaults, config);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Set config.method</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (config.method) &#123;</span><br><span class=\"line\">    config.method = config.method.toLowerCase();</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.defaults.method) &#123;</span><br><span class=\"line\">    config.method = <span class=\"keyword\">this</span>.defaults.method.toLowerCase();</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    config.method = <span class=\"string\">'get'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Hook up interceptors middleware</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> chain = [dispatchRequest, <span class=\"literal\">undefined</span>];</span><br><span class=\"line\">  <span class=\"keyword\">var</span> promise = <span class=\"built_in\">Promise</span>.resolve(config);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.interceptors.request.forEach(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unshiftRequestInterceptors</span>(<span class=\"params\">interceptor</span>) </span>&#123;</span><br><span class=\"line\">    chain.unshift(interceptor.fulfilled, interceptor.rejected);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.interceptors.response.forEach(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushResponseInterceptors</span>(<span class=\"params\">interceptor</span>) </span>&#123;</span><br><span class=\"line\">    chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (chain.length) &#123;</span><br><span class=\"line\">    promise = promise.then(chain.shift(), chain.shift());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹å‡ºï¼Œã€Œæ‹¦æˆªå™¨ã€è¿™ä¸ªåŠŸèƒ½ï¼Œæ— éæ˜¯å°†ã€Œæ‹¦æˆªå™¨ã€å’Œå®é™…çš„è¯·æ±‚æ‹¼æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæœ€å <code>axios</code> æŠ›å‡ºçš„ <code>promise</code> å¯¹è±¡å…¶å®å°±æ˜¯é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªä»»åŠ¡æ‰§è¡Œä¹‹åè¿”å›çš„ç»“æœã€‚</p>\n<p><img src=\"/images/axios/axios.jpg\" alt=\"\" class=\"Ï†cx\"></p>\n<h3 id=\"ç»‘å®šè¯·æ±‚æ–¹æ³•\">ç»‘å®šè¯·æ±‚æ–¹æ³•<a title=\"#ç»‘å®šè¯·æ±‚æ–¹æ³•\" href=\"#ç»‘å®šè¯·æ±‚æ–¹æ³•\"></a></h3>\n<p>åœ¨ <code>axios</code> ä¸­è¯·æ±‚æ–¹æ³•åˆ†ä¸¤ç§ï¼š</p>\n<ul>\n<li>ä¸éœ€è¦å¡«å…¥è¯·æ±‚å‚æ•°</li>\n<li>éœ€è¦å¡«å…¥è¯·æ±‚å‚æ•°</li>\n</ul>\n<p>æºç ä¸­åˆ†ä¸¤æ­¥å°†è¿™äº›è¯·æ±‚æ–¹æ³•æŒ‚è½½åˆ° <code>prototype</code> ä¸ŠğŸ‘‡</p>\n<ol>\n<li>æŒ‚è½½ <code>delete/get/head/options</code> æ–¹æ³•ã€‚</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">utils.forEach([<span class=\"string\">'delete'</span>, <span class=\"string\">'get'</span>, <span class=\"string\">'head'</span>, <span class=\"string\">'options'</span>], <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">forEachMethodNoData</span>(<span class=\"params\">method</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/*eslint func-names:0*/</span></span><br><span class=\"line\">  Axios.prototype[method] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url, config</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.request(mergeConfig(config || &#123;&#125;, &#123;</span><br><span class=\"line\">      method: method,</span><br><span class=\"line\">      url: url</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>æŒ‚è½½ <code>post/put/patch</code> æ–¹æ³•ã€‚</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">utils.forEach([<span class=\"string\">'post'</span>, <span class=\"string\">'put'</span>, <span class=\"string\">'patch'</span>], <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">forEachMethodWithData</span>(<span class=\"params\">method</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/*eslint func-names:0*/</span></span><br><span class=\"line\">  Axios.prototype[method] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url, data, config</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.request(mergeConfig(config || &#123;&#125;, &#123;</span><br><span class=\"line\">      method: method,</span><br><span class=\"line\">      url: url,</span><br><span class=\"line\">      data: data</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…¶ä»–\">å…¶ä»–<a title=\"#å…¶ä»–\" href=\"#å…¶ä»–\"></a></h2>\n<h3 id=\"å–æ¶ˆè¯·æ±‚\">å–æ¶ˆè¯·æ±‚<a title=\"#å–æ¶ˆè¯·æ±‚\" href=\"#å–æ¶ˆè¯·æ±‚\"></a></h3>\n<p>ä¸Šé¢æåˆ° <code>axios</code> å¯ä»¥å–æ¶ˆè¯·æ±‚ï¼Œä¸‹è¾¹æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªåŠŸèƒ½æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>\n<h4 id=\"canceltoken\">CancelToken<a title=\"#canceltoken\" href=\"#canceltoken\"></a></h4>\n<p><code>CancelToken</code> æ¥æ”¶ä¸€ä¸ª <code>executor</code> å‚æ•°ï¼Œå¹¶ç»™ <code>this</code> ç»‘å®šäº†ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œåˆ©ç”¨è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆè¯·æ±‚ã€‚<br>\nè¿™æ®µä»£ç ä¸é•¿ï¼Œæˆ‘ä»¬ç›´æ¥æ”¾å‡ºæ¥ï½</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * A `CancelToken` is an object that can be used to request cancellation of an operation.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@class</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Function&#125;</span> </span>executor The executor function.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">CancelToken</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> executor !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'executor must be a function.'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> resolvePromise;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.promise = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">promiseExecutor</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">    resolvePromise = resolve;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> token = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  executor(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cancel</span>(<span class=\"params\">message</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (token.reason) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Cancellation has already been requested</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    token.reason = <span class=\"keyword\">new</span> Cancel(message);</span><br><span class=\"line\">    resolvePromise(token.reason);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸è¿‡ï¼Œçœ¼å°–çš„åŒå­¦å¯ä»¥çœ‹åˆ°ä»£ç ä¸­å‡ºç°äº† <code>Cancel</code> è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒåˆæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * A `Cancel` is an object that is thrown when an operation is canceled.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@class</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;string=&#125;</span> </span>message The message.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Cancel</span>(<span class=\"params\">message</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.message = message;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Cancel.prototype.toString = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toString</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'Cancel'</span> + (<span class=\"keyword\">this</span>.message ? <span class=\"string\">': '</span> + <span class=\"keyword\">this</span>.message : <span class=\"string\">''</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Cancel.prototype.__CANCEL__ = <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n<p>å…¶å®å®ƒçš„ä½œç”¨ä¸å¤–ä¹å­˜æ”¾ <code>cancel message</code>ï¼Œé‚£ä¸ºä»€ä¹ˆè¦å†å®ç°ä¸€ä¸ª <code>toString</code> å‡½æ•°å‘¢ï¼Ÿ<br>\nåˆ«å¿˜äº†ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ¶‰åŠåˆ°éšå¼è½¬æ¢çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šç»å†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>\n<ol>\n<li>é¦–å…ˆè°ƒç”¨ <code>Symbol.toPrimitive</code>ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šèµ°ä»¥ä¸‹ä¸¤ä¸ªåˆ†æ”¯ã€‚</li>\n<li>å¦‚æœæ¶‰åŠåˆ° <code>string</code> ç±»å‹çš„è½¬æ¢ï¼Œä¼šå…ˆåè°ƒç”¨ <code>toString</code> å’Œ <code>valueOf</code></li>\n<li>å¦‚æœæ¶‰åŠåˆ° <code>number</code> ç±»å‹çš„è½¬æ¢ï¼Œä¼šå…ˆåè°ƒç”¨ <code>valueOf</code> å’Œ <code>toString</code></li>\n</ol>\n<h4 id=\"canceltoken.source\">CancelToken.source<a title=\"#canceltoken.source\" href=\"#canceltoken.source\"></a></h4>\n<p>å½“ç„¶ï¼Œ<code>axios</code> è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªæ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ° <code>CancelToken</code> ä¸ŠæŒ‚è½½äº†ä¸€ä¸ª <code>source</code> å‡½æ•°ï¼ŒåŒæ ·å®ƒä¹Ÿå¯ä»¥ç”¨æ¥è·å– <code>token</code> å¹¶å–æ¶ˆè¯·æ±‚ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Returns an object that contains a new `CancelToken` and a function that, when called,</span></span><br><span class=\"line\"><span class=\"comment\"> * cancels the `CancelToken`.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">CancelToken.source = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">source</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> cancel;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> token = <span class=\"keyword\">new</span> CancelToken(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">executor</span>(<span class=\"params\">c</span>) </span>&#123;</span><br><span class=\"line\">    cancel = c;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    token: token,</span><br><span class=\"line\">    cancel: cancel</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"canceltoken.prototype.throwifrequested\">CancelToken.prototype.throwIfRequested<a title=\"#canceltoken.prototype.throwifrequested\" href=\"#canceltoken.prototype.throwifrequested\"></a></h4>\n<p>è¯·æ±‚å–æ¶ˆæ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨ <code>throwIfRequested</code> æ¥æŠ›å‡ºå–æ¶ˆçš„ <code>reason</code>ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Throws a `Cancel` if cancellation has been requested.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">CancelToken.prototype.throwIfRequested = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throwIfRequested</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.reason) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">this</span>.reason;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å°ç»“\">å°ç»“<a title=\"#å°ç»“\" href=\"#å°ç»“\"></a></h4>\n<p><img src=\"/images/axios/cancel.png\" alt=\"\" class=\"Ï†cx\"></p>\n<h4 id=\"\"><a title=\"#\" href=\"#\"></a></h4>\n<h1 id=\"æ€»ç»“\">æ€»ç»“<a title=\"#æ€»ç»“\" href=\"#æ€»ç»“\"></a></h1>\n<h1 id=\"å‚è€ƒèµ„æ–™\">å‚è€ƒèµ„æ–™<a title=\"#å‚è€ƒèµ„æ–™\" href=\"#å‚è€ƒèµ„æ–™\"></a></h1>\n<ul>\n<li><a href=\"https://github.com/axios/axios\" target=\"_blank\">axios æ–‡æ¡£</a></li>\n</ul>\n","next":{"title":"121.ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº","link":"2020/08/03/121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"},"plink":"https://pigpigever.github.io/2020/08/04/axiosæºç åˆ†æ/","toc":[{"id":"axios-æ˜¯ä»€ä¹ˆ","title":"axios æ˜¯ä»€ä¹ˆ","index":"1"},{"id":"axios-çš„å¸¸è§åŠŸèƒ½","title":"axios çš„å¸¸è§åŠŸèƒ½","index":"2"},{"id":"axios-æºç åˆ†æ","title":"axios æºç åˆ†æ","index":"3","children":[{"id":"ç›®å½•","title":"ç›®å½•","index":"3.1"},{"id":"æ ¸å¿ƒåŠŸèƒ½","title":"æ ¸å¿ƒåŠŸèƒ½","index":"3.2","children":[{"id":"axios-æ„é€ å‡½æ•°","title":"Axios æ„é€ å‡½æ•°","index":"3.2.1"},{"id":"axios.prototype.request","title":"Axios.prototype.request","index":"3.2.2"},{"id":"ç»‘å®šè¯·æ±‚æ–¹æ³•","title":"ç»‘å®šè¯·æ±‚æ–¹æ³•","index":"3.2.3"}]},{"id":"å…¶ä»–","title":"å…¶ä»–","index":"3.3","children":[{"id":"å–æ¶ˆè¯·æ±‚","title":"å–æ¶ˆè¯·æ±‚","index":"3.3.1"}]}]},{"id":"æ€»ç»“","title":"æ€»ç»“","index":"4"},{"id":"å‚è€ƒèµ„æ–™","title":"å‚è€ƒèµ„æ–™","index":"5"}]}